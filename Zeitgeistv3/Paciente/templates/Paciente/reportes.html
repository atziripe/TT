{% extends "Paciente/basePacientes.html" %}

{% block title%} Reportes {% endblock %}


{% block content %}
{% load static %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.2.0/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js" integrity="sha512-hZf9Qhp3rlDJBvAKvmiG+goaaKRZA6LKUO35oK6EsM0/kjPK32Yw7URqrq3Q+Nvbbt8Usss+IekL7CRn83dYmw==" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://www.chartjs.org/samples/latest/utils.js"></script>
<div id="index-banner" class="parallax-container">
  <div class="section no-pad-bot row">
    <div class="container">
      <h1 class="header grey-text center text-darken-4 valign-wrapper" style="margin-top:30%;"> Conozcamos el avance </h1>
    </div>
  </div>
  <div class="parallax"><img src="{% static 'images/reportes-p.jpg' %}" alt="Unsplashed background img 1">
  </div>
</div>

<div class="section">
  <div class="container">
    <div class="row">
      <div class="col s12 center">
        <h4>Aquí, Usted podrá visualizar los reportes de las últimas pruebas que ha realizado.<br>Para visualizar los datos de cada sesión de sopa de letras, da clic sobre la línea.</h4>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div id="sopas" class="col s12 m6 center">
    <ul class="collapsible" data-collapsible="accordion">
      <li class="collection-header"><h4>Sopa de Letras</h4></li>
      {% if sopas|length != 0 %}
        {% for prueba in sopas %}
          <li><div class="collapsible-header"><div>{{prueba.datos.cveAcceso}} | {{prueba.datos.fechaAp}} </div></div>
              <div class="collapsible-body">
                {% if prueba.datos.cveTema.dificultad == 'F' %}
                  <p>Tema: {{prueba.datos.cveTema.tema|lower}}</p>
                  <p>Dificultad: Fácil</p>
                {% elif prueba.datos.cveTema.dificultad == 'M' %}
                  <p>Tema: {{prueba.datos.cveTema.tema|lower}}</p>
                  <p>Dificultad: Media</p>
                {% elif prueba.cveTema.dificultad == 'D' %}
                  <p>Tema: {{prueba.datos.cveTema.tema|lower}}</p>
                  <p>Dificultad: Difícil</p>
                {% endif %}  
                {% if prueba.datos.estado == 'S'%}
                  <p>Estado: Superado </p> 
                  <p>Tiempo realizado: {{prueba.datos.tiempo|stringformat:"s"}}</p>
                  <p>Tiempo promedio por palabra: {{prueba.promedio}} segundos</p>
                {% else %}
                  <p>Estado: No superado</p> 
                  <p>Esta sesión sigue activa, puedes terminarla con la misma clave para cambiar el estado. </p> 
                {% endif %}
              </div></li>
        {% endfor %}
      {% else %}
      <p>No ha realizado ninguna sesión de <strong>Sopa de letras.</strong></p>
      {% endif%}
    </ul>
  </div>
  
  <div id="reminiscencias" class="col s12 m6 center">
    <h4 class="collapsible collection-header">Reminiscencia</h4>
    {% if reminiscencia|length == 0 %}
      <p>No ha realizado ninguna sesión de <strong>Reminiscencia.</strong></p>
    {% else %}
      <table>
        <thead>
          <tr>
              <th>Clave de acceso</th>
              <th>Fecha de aplicación</th>
              <th>Resultado final</th>
          </tr>
        </thead>
        {% for rem in reminiscencia %}
        <tbody>
          <tr>
            <td>{{rem.cveAcceso}}</td>
            <td>{{rem.fechaAp}}</td>
            <td>{{rem.resultadoFinal}}/10</td>
          </tr>
        </tbody>
        {% endfor %}
      </table>
    {% endif %}
  </div>
</div>

<div class="row">
  {% if sopas|length != 0 %}
  <div class="col s12 m6 center">
    <!--<button class="waves-effect waves-light btn-large"><i class="material-icons right">equalizer</i>Ver gráfica Sopa de letras</button>-->
    <button class="waves-effect waves-light btn-small" id="shSF" value='O'><i class="material-icons right">equalizer</i>Ver gráfica Fácil</button>
    <button class="waves-effect waves-light btn-small" id="shSM" value='O'><i class="material-icons right">equalizer</i>Ver gráfica Medio</button>
    <button class="waves-effect waves-light btn-small" id="shSD" value='O'><i class="material-icons right">equalizer</i>Ver gráfica Difícil</button>
    <canvas id="graS" style="margin-top:5%; display:none"></canvas>
    <canvas id="graSF" style="margin-top:5%; display:none"></canvas>
    <canvas id="graSM" style="margin-top:5%; display:none"></canvas>
    <canvas id="graSD" style="margin-top:5%; display:none"></canvas>
  </div>
  {% endif %}

  {% if reminiscencia|length != 0 %}
  <div class="col s12 m6 center">
    <button class="waves-effect waves-light btn-large" id="shR" value='O'><i class="material-icons right">equalizer</i>Ver gráfica Reminiscencia</button>
    <canvas id="graR" style="margin-top:5%; display:none"></canvas>
  </div>
  {% endif %}
</div>

<script type="text/javascript">
  $(document).ready(function(){
    $('.collapsible').collapsible();
  });

  $(document).ready(function(){
    $('#shR').click(function () {
      var value = document.getElementById('graR').value;
      console.log(value)
      if(value == 'O'){
        document.getElementById('graR').value = 'M';
        document.getElementById('graR').style.display = 'block';
      } else {
        document.getElementById('graR').value = 'O';
        document.getElementById('graR').style.display = 'none';
      }
    });
    $('#shSF').click(function () {
      var value = document.getElementById('graSF').value;
      console.log(value)
      if(value == 'O'){
        document.getElementById('graSF').value = 'M';
        document.getElementById('graSF').style.display = 'block';
      } else {
        document.getElementById('graSF').value = 'O';
        document.getElementById('graSF').style.display = 'none';
      }
    });
    $('#shSM').click(function () {
      var value = document.getElementById('graSM').value;
      console.log(value)
      if(value == 'O'){
        document.getElementById('graSM').value = 'M';
        document.getElementById('graSM').style.display = 'block';
      } else {
        document.getElementById('graSM').value = 'O';
        document.getElementById('graSM').style.display = 'none';
      }
    });
    $('#shSD').click(function () {
      var value = document.getElementById('graSD').value;
      console.log(value)
      if(value == 'O'){
        document.getElementById('graSD').value = 'M';
        document.getElementById('graSD').style.display = 'block';
      } else {
        document.getElementById('graSD').value = 'O';
        document.getElementById('graSD').style.display = 'none';
      }
    });
  });
</script>
<script>
  var dynamicColors = function() {
    var r = Math.floor(Math.random() * 255);
    var g = Math.floor(Math.random() * 255);
    var b = Math.floor(Math.random() * 255);
    return "rgb(" + r + "," + g + "," + b + ")";
  };
  
  var rex = document.getElementById('graR').getContext('2d');
  var datos1 = new Array();
  var etiquetas1 = new Array();
  var coloR1 = new Array();
  {% for item in graficaR%}
    etiquetas1.push('{{item.clave}} | {{item.fecha}}');
    datos1.push('{{item.resultado}}'); 
    coloR1.push(dynamicColors());
  {% endfor %}
  var myChart  = new Chart(rex,{
    type: 'bar',
    data:{
        labels: etiquetas1,
        datasets:[{
            label:'Sesiones de reminiscencia',
            data:datos1,
            backgroundColor: coloR1,
        }]
    },
    options:{
        scales:{
            yAxes:[{
                    ticks:{beginAtZero:true}
            }]
        }        
    }               
  });      
</script>
<script>
  //var spx = document.getElementById('graS').getContext('2d');
  var spFx = document.getElementById('graSF').getContext('2d');
  var spMx = document.getElementById('graSM').getContext('2d');
  var spDx = document.getElementById('graSD').getContext('2d');
  var etiquetas = new Array();
  var datosWSF = new Array();
  var etiquetasWSF = new Array();
  var coloRWSF = new Array();
  var datosWSM = new Array();
  var etiquetasWSM = new Array();
  var coloRWSM = new Array();
  var datosWSD = new Array();
  var etiquetasWSD = new Array();
  var coloRWSD = new Array();
  var coloRWS = new Array();
  {% for item in graficaS%}
    {% if item.estado == 'S' %}
      etiquetas.push('{{item.datos.fecha}}');
      {% if item.dificultad == 'F' %}
        etiquetasWSF.push('{{item.datos.clave}} | {{item.datos.fecha}}');
        datosWSF.push('{{item.datos.resultado}}'); 
        coloRWSF.push(dynamicColors());
      {% elif item.dificultad == 'M'%}
        etiquetasWSM.push('{{item.datos.clave}} | {{item.datos.fecha}}');
        datosWSM.push('{{item.datos.resultado}}'); 
        coloRWSM.push(dynamicColors());
      {% elif item.dificultad == 'D' %}
        etiquetasWSD.push('{{item.datos.clave}} | {{item.datos.fecha}}');
        datosWSD.push('{{item.datos.resultado}}');
        coloRWSD.push(dynamicColors());
      {% endif %}
      coloRWS.push(dynamicColors());
    {% endif %}
  {% endfor %}
  
  var myChartF = new Chart(spFx, {
      type: 'line',
      data: {
          labels: etiquetasWSF,
          datasets: [{
              label: 'Sesiones de sopa de letras',
              data: datosWSF,
              backgroundColor:coloRWS,
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: false
              }
          }
      }
  });
  var myChartM = new Chart(spMx, {
      type: 'line',
      data: {
          labels: etiquetasWSM,
          datasets: [{
              label: 'Sesiones de sopa de letras',
              data: datosWSM,
              backgroundColor:coloRWS,
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: false
              }
          }
      }
  });
  var myChartD = new Chart(spDx, {
      type: 'line',
      data: {
          labels: etiquetasWSD,
          datasets: [{
              label: 'Sesiones de sopa de letras',
              data: datosWSD,
              backgroundColor:coloRWS,
          }]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: false
              }
          }
      }
  });
  /* General */
  /*var myChart = new Chart(spx, {
      type: 'bar',
      data: {
          labels: etiquetas,
          datasets: [
            {
              label: 'Fácil',
              data: datosWSF,
              backgroundColor:dynamicColors(),
            },
            {
              label: 'Medio',
              data: datosWSM,
              backgroundColor:dynamicColors(),
            },
            {
              label: 'Difícil',
              data: datosWSD,
              backgroundColor:dynamicColors(),
            }
          ]
      },
      options: {
          scales: {
              y: {
                  beginAtZero: true
              }
          }
      }
  });*/
  </script>

{% endblock %}